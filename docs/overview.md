## Payload

```JS
const payload = {
        MAPBOX_API: config.MAPBOX_API,
        id: containerId,
        map: {
            style: 'spandl/cl1tf9mgp003i14s2rul8tegf', // mapbox/light-v10
            zoom: 7, 
            currentZoom: 7, // only used for GUI
            geoCenterType: 'manual', // [manual, dataBound, dataCenter]
            geoCenterString: '-73.595, 45.688',
            showBuildings: true,
            minZoom: 9,
            maxZoom: 15,
        },
        data: {
            // locationPath: 'data/QC_CONDO_SOLD_METRIC.geojson', // GeoJSON with properties
            // showAsLayer: true,
            minzoom: 15,
            maxzoom: 20,
            metricAccessor: 'SQFt_mdn',
        },
        layerProperties: {
            segmentAmount: 24,
            segmentColors: ['#faffdc', '#f5da73', '#015b91'],
        },
        layers: [
            {
                name: 'cityData',
                geoJSON: 'data/LEVEL_HIGH.geojson',
                data: 'data/sold_basickpi_level_01_high_condo.json',
                geoKey: 'CCSUID',
                minzoom: 5,
                maxzoom: 8,
                metricAccessor: 'SQFt_mdn',
                visibility: true,
            },
            {
                // add more layers as required
            }

        ],
        eventCallback: mapEvents,
    };
```

|property|description|values|
|---|---|---|
| MAPBOX_API  | mapbox API code  |  *YOUR API CODE* |
| id  | id of DOM element |  *example: map* |
| eventCallback  | callback function to catch events |  *function name* |

### map
|property|description|values|
|---|---|---|
|map.style|style of map| *IDEALLY COPY MAP STYLE IN YOUR OWN MAPBOX REPO*  |
|map.zoom|initial zoom of map   | any value between 1 and 20  |
|map.currentZoom| returned by class - current zoom  | any value between 1 and 20  |
|map.geoCenterType|How to position the map|[manual, data, postalCode]|
|map.geoCenterString|Used if type is manual|String of longitude and latitude: '-73.595, 45.488'|
|map.showBuildings|Show or hide buildings|boolean|
|map.minZoom| minimal zoom of map  | any value between 1 and 20 (if not provided it is set to 5)  |
|map.maxZoom| maximal zoom of map  | any value between 1 and 20 (if not provided it is set to 20)  |

### data
|property|description|values|
|---|---|---|
|data.locationPath|Path to the location data|Currently not used|
|data.minzoom|Lock user in these zoom levels|[1-20]|
|data.maxzoom|Lock user in these zoom levels|[1-20]|

### Layer Properties
|property|description|values|
|---|---|---|
|layerProperties.segmentAmount|Number of colors generated by color scale|number|
|layerProperties.segmentColors|Array of colors used to generate the color scale|array with color names|

### Layers
|property|description|values|
|---|---|---|
|layers|Choropleth layers|array with objects|
|layers[x].name|Name of layer|string|
|layers[x].geoJSON|Path to geoJSON|string|
|layers[x].data|Path to data file|string|
|layers[x].geoKey|key that will link the data to the geoJSON features|string|
|layers[x].minzoom|starting zoom level|number|
|layers[x].maxzoom|ending zoom level|number|
|layers[x].metricAccessor|the metric used to calculate the color scale|string|
|layers[x].visibility|option to hide the layer|boolean|

## App Status
The application is updating an object called `appState`.

The value can be watched directly or by using a callback function which will be called every time the object changes.

`appState` is an object containing 4 properties:
* message
* type
* value
* currentZoom (current zoom level)
* data (optional)

Example:
```
{
    type: 'user',
    value: 'click',
    message: `clicked on ${layerProps.geoKey}: ${feature.properties[layerProps.geoKey]}`,
    currentZoom: 9.12
    data: {
        source: layerProps.name,
        key: [layerProps.geoKey],
        keyValue: feature.properties[layerProps.geoKey],
}
```

All occurrences of `appState` without the `data` attribute are general messages that can be used to trace the behavior of the library.

On some user interactions, (example, click on a geo feature), the data property contains more information.
In the above sample, the object contains all properties required to identify the clicked geo feature:

* source: the source name as specified in the payload
* key: the key name of the feature
* keyValue: the value of the key


## Class Methods

### flyToFeature
Finds and flies to the bounds of a geo JSON feature
```JS
const JSONfeature = { id: 'lowLevelData', key: 'UNIQUE_ID', value: '2' };
map.flyToFeature(JSONfeature) 
```
* id: name of the layer
* key in geo JSON
* value of key

### centerSelectedFeature
Centers the selected feature without changing the zoom level
```JS
map.centerSelectedFeature() 
```


### flyToSelectedFeature
If the user has selected a feature on the map, this method flies to its bounds
The geo padding is an array with 4 numbers, expressing a percentage of the width/height

`[10, 0, 10, 0]` will create a space left and right (and depending on the shape create vertical padding as well).
`[0, 25, 0, 0]` will create a larger space to the top.
`geoPadding` is optional.


```JS
map.flyToSelectedFeature({geoPadding})
```
### flyToCenter
Flies to a specific point on a specific zoom level

```JS
const center = '-73.595, 45.688';
const zoom = 10;
map.flyToCenter({ center, zoom});
```

### updateLayers
Updates the map with all properties of the payload.

```JS
// update choropleth calculations to a different metric
map.payload.layers[0].metricAccessor = 'SQFt_avg'
map.updateLayers();
```

### removeLayerHighlights
Remove highlights of features that have been created by a user click
```JS
map.removeLayerHighlights();
```

### scaleColorsToScreen
Recalculates the color scheme based on the features visible in the viewport.

```JS
map.scaleColorsToScreen();
```